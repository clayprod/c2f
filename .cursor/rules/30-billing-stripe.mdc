---
description: "USE WHEN implementando billing, planos, assinaturas, Stripe, webhooks e controle de acesso por plano."
alwaysApply: false
---

# Billing/Planos (Stripe)

## Regras de assinatura
- Fonte da verdade de pagamento é Stripe (subscription, invoice, payment_intent).
- O app mantém espelho: customer_id, subscription_id, status, plan_id, current_period_end.

## Webhooks
- Webhook é obrigatório e idempotente (dedupe por event.id).
- Sempre validar assinatura do webhook.
- Nunca confiar em dados vindos do client para 'is_premium'.

## Controle por plano
- Implementar "feature flags" por plano:
  - limites (ex: contas, importações, chamadas do Advisor, sync Pluggy)
  - features (ex: relatórios, projeções avançadas)
- O backend deve bloquear features proibidas (não só a UI).
